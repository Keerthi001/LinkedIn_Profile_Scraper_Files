const l="https://www.linkedin.com",c={LOGIN_URL:"https://www.linkedin.com/oauth/v2/authorization?response_type=code",APP_CLIENT_ID:"86h99ith096cfg",REDIRECT_URL:"linkedin_callback",SCOPES:"openid profile email r_basicprofile r_1st_connections_size"},p="https://dev.postaba.com",R={SCRAPPER_SECRET_CODE:"linkedin-data-scrapper-secret-code",CURRENT_PROFILE:"current-profile",SHOW_SCRAPABA:"show-scrapaba",CURRENT_PAGE:"current-page",TOTAL_NO_OF_PAGE:"total-no-of-page"},_={SECRET_CODE_RECEIVED_FROM_COOKIE:"SECRET_CODE_RECEIVED_FROM_COOKIE",SET_SECRET_CODE_IN_COOKIE:"SET_SECRET_CODE_IN_COOKIE",GET_SECRET_CODE_FROM_COOKIE:"GET_SECRET_CODE_FROM_COOKIE",INSERT_SCRAPPER_PLUGIN:"INSERT_SCRAPPER_PLUGIN",LOGIN_WITH_LINKEDIN_REQUEST:"LOGIN_WITH_LINKEDIN_REQUEST"},L=async(n="",E,e,o)=>(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",code:E,rurl:e,"product-code":"scraper"},body:JSON.stringify(o)})).json(),P=(n,E,e)=>{var o;(o=chrome==null?void 0:chrome.cookies)==null||o.set({url:l,name:n,value:E},e)},i=async()=>{await chrome.tabs.query({active:!0,currentWindow:!0},n=>{var e;const E=n==null?void 0:n[0];(e=chrome==null?void 0:chrome.cookies)==null||e.get({name:R.SCRAPPER_SECRET_CODE,url:l},o=>{chrome.tabs.sendMessage(E==null?void 0:E.id,{name:_.SECRET_CODE_RECEIVED_FROM_COOKIE,payload:{cookie:o}}).catch(()=>{})})})},h=n=>{const E=c.LOGIN_URL,e=c.APP_CLIENT_ID,o=chrome.identity.getRedirectURL()+c.REDIRECT_URL,C=c.SCOPES;chrome.identity.launchWebAuthFlow({url:`${E}&client_id=${e}&redirect_uri=${o}&scope=${C}`,interactive:!0},async N=>{try{const r=new URL(N),a=new URLSearchParams(r.search).get("code");a&&L(`${p}/user/signup`,a,o,{}).then(s=>{var I;const u=((I=s==null?void 0:s.user)==null?void 0:I.scraper_code)||"";P(R.SCRAPPER_SECRET_CODE,u,()=>{i()})})}catch(r){console.log("Error while linkedin login:",r)}})};var O,t,T;(T=(t=(O=chrome==null?void 0:chrome.runtime)==null?void 0:O.onMessage)==null?void 0:t.addListener)==null||T.call(t,n=>{const{payload:E}=n;n.name===_.SET_SECRET_CODE_IN_COOKIE?P(R.SCRAPPER_SECRET_CODE,E.token,()=>{i()}):n.name===_.GET_SECRET_CODE_FROM_COOKIE?i():n.name===_.LOGIN_WITH_LINKEDIN_REQUEST&&h(E.currentTabId)});const D=async n=>{await chrome.tabs.query({active:!0,currentWindow:!0},E=>{var o;const e=E==null?void 0:E[0];e!=null&&e.id&&((o=e==null?void 0:e.url)!=null&&o.includes("linkedin.com"))&&chrome.tabs.sendMessage(e==null?void 0:e.id,{name:_.INSERT_SCRAPPER_PLUGIN,payload:{currentTabId:n}}).catch(()=>{})})};var d,S;(S=(d=chrome==null?void 0:chrome.tabs)==null?void 0:d.onUpdated)==null||S.addListener((n,E,e)=>{E.status=="complete"&&e.status=="complete"&&e.url!=null&&D(n)});
//# sourceMappingURL=index.js.map
